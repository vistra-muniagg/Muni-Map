// --- Global variables ---
let map;
let geojsonLayer;
const cousubValues = new Set();

// --- Initialize map ---
map = L.map('map').setView([37.8, -96], 4);

// --- Basemap ---
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  maxZoom: 18,
  attribution: 'Â© OpenStreetMap'
}).addTo(map);

// --- Style function ---
function styleFeature(feature) {
  return {
    color: '#444',
    weight: 1,
    fillColor: '#74b9ff',
    fillOpacity: 0.6
  };
}

// --- Popup function ---
function onEachFeature(feature, layer) {
  layer.bindPopup(
    `<strong>${feature.properties.GEO_Name}</strong><br/>
     GEOID: ${feature.properties.GEO_ID}<br/>
     COUSUB: ${feature.properties.COUNTYFP}`
  );
}

// --- Load GeoJSON ---
fetch('./data/OH_GEO.geojson')
  .then(r => r.json())
  .then(data => {

    geojsonLayer = L.geoJSON(data, {
      style: styleFeature,
      onEachFeature: function (feature, layer) {
        // Collect COUSUB values
        if (feature.properties.COUNTYFP) {
          cousubValues.add(feature.properties.COUNTYFP);
        }
        onEachFeature(feature, layer);
      }
    }).addTo(map);

    // Populate dropdown
    const select = document.getElementById('cousubFilter');
    Array.from(cousubValues).sort().forEach(v => {
      const opt = document.createElement('option');
      opt.value = v;
      opt.textContent = v;
      select.appendChild(opt);
    });

    map.fitBounds(geojsonLayer.getBounds());
  });

// --- Filter behavior ---
document.getElementById('cousubFilter').addEventListener('change', function () {
  const selected = this.value;

  geojsonLayer.eachLayer(layer => {
    const match =
      !selected ||
      layer.feature.properties.COUNTYFP === selected;

    layer.setStyle({
      opacity: match ? 1 : 0,
      fillOpacity: match ? 0.6 : 0
    });
  });
});
